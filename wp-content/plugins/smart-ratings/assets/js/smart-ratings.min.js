jQuery(function(i){function n(t){for(var a=t+"=",n=document.cookie.split(";"),s=0;s<n.length;s++){var i=n[s].trim();if(0===i.indexOf(a))return i.substring(a.length)}return null}function s(t,a){t.find(".star").each(function(){i(this).toggleClass("active",i(this).data("rating")<=a)})}i(document).on("mouseenter",".smart-rating .star",function(){s(i(this).closest(".stars"),i(this).data("rating"))}),i(document).on("mouseleave",".smart-rating .stars",function(){var t=i(this).data("selected")||0;s(i(this),t)}),i(document).on("click",".smart-rating .star",function(){var r=i(this).closest(".smart-rating"),t=r.data("post-id"),o=i(this).data("rating"),a=r.find(".load-stats").data("nonce"),d=r.find(".stats"),c="smart_rated_"+t;console.log(c),!SmartRatings.isLoggedIn&&n(c)?d.text("You already rated this. You can change it."):(d.text("Saving rating..."),i.post(SmartRatings.ajax_url,{action:"smart_ratings_submit",post_id:t,rating:o,nonce:a}).done(function(t){var a,n,s,i,e;t.success?(a=c,n=o,e="",(s=365)&&((i=new Date).setTime(i.getTime()+24*s*60*60*1e3),e="; expires="+i.toUTCString()),document.cookie=a+"="+n+e+"; path=/",r.find(".stars").data("selected",o),d.text("Rating saved")):d.text(t.data||"Error saving rating.")}).fail(function(){d.text("Something went wrong.")}))}),i(".smart-rating").each(function(){var t,a=n("smart_rated_"+i(this).data("post-id"));a&&((t=i(this).find(".stars")).data("selected",parseInt(a)),s(t,parseInt(a)))}),i(document).on("click",".smart-rating .load-stats",function(){var t=i(this).closest(".smart-rating"),a=t.data("post-id"),n=i(this).data("nonce"),s=t.find(".stats");s.text("Loading..."),i.post(SmartRatings.ajax_url,{action:"smart_ratings_stats",post_id:a,nonce:n}).done(function(t){var a;t.success&&t.data?(a=parseFloat(t.data.average_rating).toFixed(1)||0,t=t.data.total_votes||0,s.text("Average: "+a+" ("+t+" votes)")):s.text("No ratings yet.")}).fail(function(){s.text("Error loading stats.")})})});